# ECS Container Instance

A container instance is an EC2 instance registered to a cluster. 
Connects via a container agent. 
LifeCycle States
- ACTIVE and connected (registered container instance and connection status is TRUE - Container instance is UP.)
- ACTIVE and disconnected (Stopped container instance)
- INACTIVE (de-registered container instance and will not be seen as part of the cluster)

```bash
aws> ec2 run-instances --image-id ami-0b16d80945b1a9c7d --count 1 --instance-type t2.micro --iam-instance-profile Name=ecsInstanceRole --key-name ~/Documents/pem-keys/elk-stack.pem --security-group-ids sg-02909c0c9fb1ace0e --user-data file://copy-ecs-config-to-s3
```

```bash
aws> ecs list-container-instances --cluster deepdive
```

```
--------------------------------------------------------------------------------------------------
|                                     ListContainerInstances                                     |
+------------------------------------------------------------------------------------------------+
||                                     containerInstanceArns                                    ||
|+----------------------------------------------------------------------------------------------+|
||  arn:aws:ecs:us-east-1:289503391411:container-instance/6368caa4-6386-4a5b-9c60-ac752591b819  ||
|+----------------------------------------------------------------------------------------------+|
```

```bash
aws> ecs describe-container-instances --cluster deepdive --container-instances arn:aws:ecs:us-east-1:289503391411:container-instance/6368caa4-6386-4a5b-9c60-ac752591b819
```

```
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|                                                                                                DescribeContainerInstances                                                                                                |
+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
||                                                                                                   containerInstances                                                                                                   ||
|+----------------+----------------------------------------------------------------------------------------------+----------------------+--------------------+-----------------+--------------------+---------+-----------+|
|| agentConnected |                                    containerInstanceArn                                      |    ec2InstanceId     | pendingTasksCount  |  registeredAt   | runningTasksCount  | status  |  version  ||
|+----------------+----------------------------------------------------------------------------------------------+----------------------+--------------------+-----------------+--------------------+---------+-----------+|
||  True          |  arn:aws:ecs:us-east-1:289503391411:container-instance/6368caa4-6386-4a5b-9c60-ac752591b819  |  i-0bccc3b7f5f2fa1bf |  0                 |  1567565218.739 |  0                 |  ACTIVE |  3        ||
|+----------------+----------------------------------------------------------------------------------------------+----------------------+--------------------+-----------------+--------------------+---------+-----------+|
|||                                                                                                      attributes                                                                                                      |||
||+----------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------+||
|||                                                                           name                                                                           |                           value                           |||
||+----------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------+||
|||  ecs.capability.secrets.asm.environment-variables                                                                                                        |                                                           |||
|||  ecs.capability.branch-cni-plugin-version                                                                                                                |  cdd89b92-                                                |||
|||  ecs.ami-id                                                                                                                                              |  ami-0b16d80945b1a9c7d                                    |||
|||  ecs.capability.secrets.asm.bootstrap.log-driver                                                                                                         |                                                           |||
|||  ecs.capability.task-eia.optimized-cpu                                                                                                                   |                                                           |||
|||  com.amazonaws.ecs.capability.logging-driver.none                                                                                                        |                                                           |||
|||  ecs.capability.ecr-endpoint                                                                                                                             |                                                           |||
|||  ecs.capability.docker-plugin.local                                                                                                                      |                                                           |||
|||  ecs.capability.task-cpu-mem-limit                                                                                                                       |                                                           |||
|||  ecs.capability.secrets.ssm.bootstrap.log-driver                                                                                                         |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.30                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.31                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.32                                                                                                     |                                                           |||
|||  ecs.availability-zone                                                                                                                                   |  us-east-1d                                               |||
|||  ecs.capability.aws-appmesh                                                                                                                              |                                                           |||
|||  com.amazonaws.ecs.capability.logging-driver.awslogs                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.24                                                                                                     |                                                           |||
|||  ecs.capability.task-eni-trunking                                                                                                                        |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.25                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.26                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.27                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.28                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.privileged-container                                                                                                       |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.29                                                                                                     |                                                           |||
|||  ecs.cpu-architecture                                                                                                                                    |  x86_64                                                   |||
|||  ecs.capability.firelens.fluentbit                                                                                                                       |                                                           |||
|||  com.amazonaws.ecs.capability.ecr-auth                                                                                                                   |                                                           |||
|||  ecs.os-type                                                                                                                                             |  linux                                                    |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.20                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.21                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.22                                                                                                     |                                                           |||
|||  ecs.capability.private-registry-authentication.secretsmanager                                                                                           |                                                           |||
|||  ecs.capability.task-eia                                                                                                                                 |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.23                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.logging-driver.syslog                                                                                                      |                                                           |||
|||  com.amazonaws.ecs.capability.logging-driver.awsfirelens                                                                                                 |                                                           |||
|||  com.amazonaws.ecs.capability.logging-driver.json-file                                                                                                   |                                                           |||
|||  ecs.capability.execution-role-awslogs                                                                                                                   |                                                           |||
|||  ecs.vpc-id                                                                                                                                              |  vpc-8954fcf3                                             |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.17                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.18                                                                                                     |                                                           |||
|||  com.amazonaws.ecs.capability.docker-remote-api.1.19                                                                                                     |                                                           |||
|||  ecs.capability.task-eni                                                                                                                                 |                                                           |||
|||  ecs.capability.firelens.fluentd                                                                                                                         |                                                           |||
|||  ecs.capability.execution-role-ecr-pull                                                                                                                  |                                                           |||
|||  ecs.capability.container-health-check                                                                                                                   |                                                           |||
|||  ecs.subnet-id                                                                                                                                           |  subnet-82c45eac                                          |||
|||  ecs.instance-type                                                                                                                                       |  t2.micro                                                 |||
|||  com.amazonaws.ecs.capability.task-iam-role-network-host                                                                                                 |                                                           |||
|||  ecs.capability.container-ordering                                                                                                                       |                                                           |||
|||  ecs.capability.cni-plugin-version                                                                                                                       |  91ccefc8-2019.06.0                                       |||
|||  ecs.capability.pid-ipc-namespace-sharing                                                                                                                |                                                           |||
|||  ecs.capability.secrets.ssm.environment-variables                                                                                                        |                                                           |||
|||  com.amazonaws.ecs.capability.task-iam-role                                                                                                              |                                                           |||
||+----------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------+||
|||                                                                                                  registeredResources                                                                                                 |||
||+-------------------------------------------------+------------------------------------------------------+--------------------------------------------+--------------------------+-------------------------------------+||
|||                   doubleValue                   |                    integerValue                      |                 longValue                  |          name            |                type                 |||
||+-------------------------------------------------+------------------------------------------------------+--------------------------------------------+--------------------------+-------------------------------------+||
|||  0.0                                            |  1024                                                |  0                                         |  CPU                     |  INTEGER                            |||
||+-------------------------------------------------+------------------------------------------------------+--------------------------------------------+--------------------------+-------------------------------------+||
|||                                                                                                  registeredResources                                                                                                 |||
||+------------------------------------------------+----------------------------------------------------+------------------------------------------+--------------------------------+------------------------------------+||
|||                   doubleValue                  |                   integerValue                     |                longValue                 |             name               |               type                 |||
||+------------------------------------------------+----------------------------------------------------+------------------------------------------+--------------------------------+------------------------------------+||
|||  0.0                                           |  983                                               |  0                                       |  MEMORY                        |  INTEGER                           |||
||+------------------------------------------------+----------------------------------------------------+------------------------------------------+--------------------------------+------------------------------------+||
|||                                                                                                  registeredResources                                                                                                 |||
||+-----------------------------------------------+---------------------------------------------------+------------------------------------------+----------------------------+------------------------------------------+||
|||                  doubleValue                  |                   integerValue                    |                longValue                 |           name             |                  type                    |||
||+-----------------------------------------------+---------------------------------------------------+------------------------------------------+----------------------------+------------------------------------------+||
|||  0.0                                          |  0                                                |  0                                       |  PORTS                     |  STRINGSET                               |||
||+-----------------------------------------------+---------------------------------------------------+------------------------------------------+----------------------------+------------------------------------------+||
||||                                                                                                   stringSetValue                                                                                                   ||||
|||+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+|||
||||  22                                                                                                                                                                                                                ||||
||||  2376                                                                                                                                                                                                              ||||
||||  2375                                                                                                                                                                                                              ||||
||||  51678                                                                                                                                                                                                             ||||
||||  51679                                                                                                                                                                                                             ||||
|||+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+|||
|||                                                                                                  registeredResources                                                                                                 |||
||+--------------------------------------------+------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+||
|||                 doubleValue                |                 integerValue                   |               longValue               |                 name                  |                 type                   |||
||+--------------------------------------------+------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+||
|||  0.0                                       |  0                                             |  0                                    |  PORTS_UDP                            |  STRINGSET                             |||
||+--------------------------------------------+------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+||
|||                                                                                                  remainingResources                                                                                                  |||
||+-------------------------------------------------+------------------------------------------------------+--------------------------------------------+--------------------------+-------------------------------------+||
|||                   doubleValue                   |                    integerValue                      |                 longValue                  |          name            |                type                 |||
||+-------------------------------------------------+------------------------------------------------------+--------------------------------------------+--------------------------+-------------------------------------+||
|||  0.0                                            |  1024                                                |  0                                         |  CPU                     |  INTEGER                            |||
||+-------------------------------------------------+------------------------------------------------------+--------------------------------------------+--------------------------+-------------------------------------+||
|||                                                                                                  remainingResources                                                                                                  |||
||+------------------------------------------------+----------------------------------------------------+------------------------------------------+--------------------------------+------------------------------------+||
|||                   doubleValue                  |                   integerValue                     |                longValue                 |             name               |               type                 |||
||+------------------------------------------------+----------------------------------------------------+------------------------------------------+--------------------------------+------------------------------------+||
|||  0.0                                           |  983                                               |  0                                       |  MEMORY                        |  INTEGER                           |||
||+------------------------------------------------+----------------------------------------------------+------------------------------------------+--------------------------------+------------------------------------+||
|||                                                                                                  remainingResources                                                                                                  |||
||+-----------------------------------------------+---------------------------------------------------+------------------------------------------+----------------------------+------------------------------------------+||
|||                  doubleValue                  |                   integerValue                    |                longValue                 |           name             |                  type                    |||
||+-----------------------------------------------+---------------------------------------------------+------------------------------------------+----------------------------+------------------------------------------+||
|||  0.0                                          |  0                                                |  0                                       |  PORTS                     |  STRINGSET                               |||
||+-----------------------------------------------+---------------------------------------------------+------------------------------------------+----------------------------+------------------------------------------+||
||||                                                                                                   stringSetValue                                                                                                   ||||
|||+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+|||
||||  22                                                                                                                                                                                                                ||||
||||  2376                                                                                                                                                                                                              ||||
||||  2375                                                                                                                                                                                                              ||||
||||  51678                                                                                                                                                                                                             ||||
||||  51679                                                                                                                                                                                                             ||||
|||+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+|||
|||                                                                                                  remainingResources                                                                                                  |||
||+--------------------------------------------+------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+||
|||                 doubleValue                |                 integerValue                   |               longValue               |                 name                  |                 type                   |||
||+--------------------------------------------+------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+||
|||  0.0                                       |  0                                             |  0                                    |  PORTS_UDP                            |  STRINGSET                             |||
||+--------------------------------------------+------------------------------------------------+---------------------------------------+---------------------------------------+----------------------------------------+||
|||                                                                                                      versionInfo                                                                                                     |||
||+----------------------------------------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------+||
|||                   agentHash                  |                       agentVersion                        |                                               dockerVersion                                               |||
||+----------------------------------------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------+||
|||  02ff320c                                    |  1.30.0                                                   |  DockerVersion: 18.06.1-ce                                                                                |||
||+----------------------------------------------+-----------------------------------------------------------+-----------------------------------------------------------------------------------------------------------+||
```